<p-dialog
  [header]="dialogTitle"
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '500px' }"
  (onHide)="close()"
>
  <form [formGroup]="eventForm" (ngSubmit)="onSave()" class="space-y-4">
    <!-- Title -->
    <div class="field">
      <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
        Title <span class="text-red-500">*</span>
      </label>
      <input
        pInputText
        id="title"
        formControlName="title"
        class="w-full"
        placeholder="Event title"
      />
      @if (eventForm.get('title')?.invalid && eventForm.get('title')?.touched) {
        <small class="text-red-600">Title is required</small>
      }
    </div>

    <!-- Calendar Selection -->
    <div class="field">
      <label for="calendar" class="block text-sm font-medium text-gray-700 mb-2">
        Calendar <span class="text-red-500">*</span>
      </label>
      <p-dropdown
        formControlName="calendar_id"
        [options]="calendarService.calendars()"
        optionLabel="name"
        optionValue="id"
        placeholder="Select a calendar"
        styleClass="w-full"
      >
        <ng-template let-calendar pTemplate="item">
          <div class="flex items-center">
            <div
              class="w-3 h-3 rounded-full mr-2"
              [style.background-color]="calendar.color"
            ></div>
            <span>{{ calendar.name }}</span>
          </div>
        </ng-template>
      </p-dropdown>
      @if (eventForm.get('calendar_id')?.invalid && eventForm.get('calendar_id')?.touched) {
        <small class="text-red-600">Calendar is required</small>
      }
    </div>

    <!-- All Day Checkbox -->
    <div class="field">
      <div class="flex items-center">
        <p-checkbox
          formControlName="all_day"
          [binary]="true"
          inputId="all_day"
          (onChange)="onAllDayChange()"
        ></p-checkbox>
        <label for="all_day" class="ml-2 text-sm font-medium text-gray-700">
          All day event
        </label>
      </div>
    </div>

    <!-- Start and End Time -->
    <div class="grid grid-cols-2 gap-4">
      <div class="field">
        <label for="start" class="block text-sm font-medium text-gray-700 mb-2">
          Start <span class="text-red-500">*</span>
        </label>
        <p-calendar
          formControlName="start_time"
          [showTime]="!eventForm.get('all_day')?.value"
          [showSeconds]="false"
          dateFormat="mm/dd/yy"
          [hourFormat]="12"
          styleClass="w-full"
          inputStyleClass="w-full"
        ></p-calendar>
      </div>

      <div class="field">
        <label for="end" class="block text-sm font-medium text-gray-700 mb-2">
          End <span class="text-red-500">*</span>
        </label>
        <p-calendar
          formControlName="end_time"
          [showTime]="!eventForm.get('all_day')?.value"
          [showSeconds]="false"
          dateFormat="mm/dd/yy"
          [hourFormat]="12"
          styleClass="w-full"
          inputStyleClass="w-full"
        ></p-calendar>
      </div>
    </div>

    <!-- Location -->
    <div class="field">
      <label for="location" class="block text-sm font-medium text-gray-700 mb-2">
        Location
      </label>
      <input
        pInputText
        id="location"
        formControlName="location"
        class="w-full"
        placeholder="Add location"
      />
    </div>

    <!-- Description -->
    <div class="field">
      <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
        Description
      </label>
      <textarea
        pInputTextarea
        id="description"
        formControlName="description"
        rows="3"
        class="w-full"
        placeholder="Add description"
      ></textarea>
    </div>

    <!-- Color Override -->
    <div class="field">
      <label for="color" class="block text-sm font-medium text-gray-700 mb-2">
        Custom Color (optional)
      </label>
      <p-colorPicker
        formControlName="color_override"
        [inline]="false"
      ></p-colorPicker>
    </div>
  </form>

  <ng-template pTemplate="footer">
    <div class="flex justify-between">
      <div>
        @if (isEditMode) {
          <button
            pButton
            label="Delete"
            icon="pi pi-trash"
            class="p-button-danger"
            (click)="onDelete()"
            [disabled]="loading()"
          ></button>
        }
      </div>
      <div class="flex gap-2">
        <button
          pButton
          label="Cancel"
          class="p-button-text"
          (click)="close()"
          [disabled]="loading()"
        ></button>
        <button
          pButton
          label="Save"
          icon="pi pi-check"
          (click)="onSave()"
          [loading]="loading()"
          [disabled]="eventForm.invalid"
        ></button>
      </div>
    </div>
  </ng-template>
</p-dialog>

<!-- Delete Confirmation Dialog -->
<p-dialog
  header="Confirm Delete"
  [(visible)]="showDeleteConfirm"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '400px' }"
>
  <p class="text-gray-700">Are you sure you want to delete this event? This action cannot be undone.</p>

  <ng-template pTemplate="footer">
    <button
      pButton
      label="Cancel"
      class="p-button-text"
      (click)="cancelDelete()"
    ></button>
    <button
      pButton
      label="Delete"
      icon="pi pi-trash"
      class="p-button-danger"
      (click)="confirmDelete()"
      [loading]="loading()"
    ></button>
  </ng-template>
</p-dialog>
